<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="icon" href="../assets/images/title.png" type="image/png" sizes="16x16">
<title>登录</title>
<meta name="keywords" content="" />
<meta name="description" content="" />
<link rel="stylesheet" href="../common/common.css">
<link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="../assets/css/login_register.css">
</head>
<body>
	<header>
		<img src="/assets/css/icon/logo_white.svg">
	</header>
	<form class="login_form">
		<h1 style="font-weight: 400;">登录</h1>
		<div class="inp">
			<input type="text" name="phone" class="phone" placeholder="手机号/邮箱">
		</div>
		<div class="inp">
			<input type="password" name="pwd" class="pwd" placeholder="请输入密码">
		</div>
		<div class="inp flex flex-pack-justify" style="">
			<input type="text" name="epid" class="epid" placeholder="请输入验证码" style="width: 198px;">
			<span id="v_container"></span>
		</div>
		<span class="login_warn warn" style="float: left;color: #F5222D">用户名或密码错误</span>
		<span class="epid_warn warn" style="float: left;color: #F5222D">验证码错误</span>

		<div>
			<button type="button" id="submit" class="btn">立即登录</button>
		</div>
		<div>
			<span><a href="./register.html">立即注册</a></span>
			<span><a href="./forgetPwd.html">忘记密码？</a></span>
		</div>

	</form>
<div id="footer"></div>
<script type="text/javascript" src='../assets/js/jquery.min.js'></script>
<script type="text/javascript" src='../assets/js/util.js'></script>
<script type="text/javascript" src="/common/load.js"></script>
<script type="text/javascript" src='../assets/js/gVerify.js'></script>
<script type="">
	var verifyCode = new GVerify("v_container");
	// 只传一个id的时候，默认类型为数字和字母混合：“blend”
	// 也可传多个参数typ：number：纯数字类型，letter：纯字母类型
	// verifyCode.refresh();刷新图形验证码
	// verifyCode.validate(code);验证图形验证码，参数code为用户输入的验证码，返回值：正确：true,错误：false
	$("#submit").click(function () {
		$('.warn').css('display', 'none');
		var datalogin = {
			username: $("input[name='phone']").val().trim(),
			password: $("input[name='pwd']").val().trim(),
			grant_type: "password"
		}
		console.log(datalogin)
		// $(this).loading();
		var that = this;
		$.ajax({
		   headers: {
		          Accept: "application/json; charset=utf-8",
		    	  Authorization:"Basic cHJvbW9zZXJ2ZXI6ZTYxOTcyMDViYTZmOWM2"
		      },
		   type: 'POST',
		   url: '/promo/token',
		   data: datalogin,
		   contentType: "application/x-www-form-urlencoded",
			success: function (data) {
                var isEpid = verifyCode.validate($("input[name='epid']").val().trim());
                if(!isEpid) {
                    $('.epid_warn').css('display', 'inline-block')
                    return false;
                }
				$(that).loading()
                Util.setCookie('Authorization', data.access_token, 1);
				window.location.href='/dist/index.html'
			},
			error: function (data) {
				$(that).loading('close')
				$(".login_warn").css({
					'display': 'inline-block'
				})
			}
		});
	});


</script>
<style type="text/css">
	.warn {
		display: none;
	}
</style>
</body>
</html>