<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta name="keywords" content="" />
	<meta name="description" content="" />
	<link rel="icon" href="../assets/images/title.png" type="image/png" sizes="16x16">
	<link rel="stylesheet" href="../assets/css/bootstrap.min.css">
	<title>mobipromo</title>
</head>
<body>
	<div style="padding: 20px;">
		<textarea id="codes" cols="30" rows="10" class="form-group"></textarea>
		<div></div>
		<button class="btn btn-default disable">禁用F码</button>
		<button class="btn btn-default used">可用F码</button>
		<button class="btn btn-default" id="disabled">不可用F码</button>
		<button class="btn btn-default" id="none">不存在F码</button>
		<div id="div1"></div>
	</div>
</body>
<script type="text/javascript" src='../assets/js/jquery-3.2.1.min.js'></script>
<script type="text/javascript" src='../assets/js/bootstrap.min.js'></script>
<script src='../assets/js/util.js'></script>
<script>
$(function() {
	$('.disable').on('click', function() {
		var result = confirm('确定禁用?');
		if(!result)
			return;
		$.ajax({
			url: '/promo/manage/coupon/tempUsed',
			type: 'POST',
			data: {codes: $('#codes').val()},
			success: function(data) {
				if(data.isSuccess) {
					alert('success ' + data.len + '个');
				}else {
					alert('fail');
				}
			}
		});
	});

	$('.used').on('click', function() {
		$.ajax({
			url: '/promo/manage/coupon/checkCodes',
			type: 'POST',
			data: {
				codes: $('#codes').val(),
				used: true
			},
			success: function(data) {
				if(data.isSuccess) {
					var html = [];
					for(var i = 0, len = data.coupons.length; i < len; i++) {
						html.push(data.coupons[i].code);
					}
					$('#div1').html('可用' + data.coupons.length + '个<br>' + html.join('<br>'));
				}else {
					alert('fail');
				}
			}
		});
	});

	$('#disabled').on('click', function() {
		$.ajax({
			url: '/promo/manage/coupon/checkCodes',
			type: 'POST',
			data: {
				codes: $('#codes').val(),
				used: false
			},
			success: function(data) {
				if(data.isSuccess) {
					var html = [];
					for(var i = 0, len = data.coupons.length; i < len; i++) {
						html.push(data.coupons[i].code);
					}
					$('#div1').html('不可用' + data.coupons.length + '个<br>' + html.join('<br>'));
				}else {
					alert('fail');
				}
			}
		});
	});

	$('#none').on('click', function() {
		$.ajax({
			url: '/promo/manage/coupon/checkCodes',
			type: 'POST',
			data: {
				codes: $('#codes').val()
			},
			success: function(data) {
				if(data.isSuccess) {
					var codes = $('#codes').val().split('\n');
					var tempCodes = $('#codes').val().toUpperCase().split('\n');
					for(var i = 0, len = data.coupons.length; i < len; i++) {
						var code = data.coupons[i].code;
						var index = tempCodes.indexOf(code.toUpperCase());
						if(index >= 0) {
							codes.splice(index, 1);
						}
					}
					$('#div1').html('不存在' + codes.length + '个<br>' + codes.join('<br>'));
				}else {
					alert('fail');
				}
			}
		});
	});
});
</script>
</html>